{
    "version": 3,
    "terraform_version": "0.11.11",
    "serial": 2,
    "lineage": "14ee038f-af67-dc54-0112-1cc0026d092e",
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {},
            "depends_on": []
        },
        {
            "path": [
                "root",
                "setup_nis"
            ],
            "outputs": {},
            "resources": {
                "data.template_file.nis_client_script": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "33173d6d77cfbc7203fc41e527e2ecb88a2984973a1227d87d1a5683105f4c53",
                        "attributes": {
                            "id": "33173d6d77cfbc7203fc41e527e2ecb88a2984973a1227d87d1a5683105f4c53",
                            "rendered": "#!/bin/bash\n#######################################################################################################################################################\n### This bootstrap script runs on glusterfs clients and does the following\n### 1- Install gluster packages on all nodes\n### 2- Mount client to the glusterFS server volume\n### 3- Check if mounted successfully by command \"df\"\n######################################################################################################################################################\n\nexec \u0026\u003e bootstrap-client-logfile.txt\nset -x\n\nexport server_host_name=\"nis-server\"\necho \"server_host_name is $server_host_name\"\n\nexport nis_domain_name=\"nisser.nis.oraclevcn.com\"\necho \"nis_domain_name is $nis_domain_name\"\n\nexport server_domain_name=\"nisser.nis.oraclevcn.com\"\necho \"server_domain_name is $server_domain_name\"\n\nexport nis_server_full_hostname=$server_host_name.$server_domain_name\necho \"nis_server_full_hostname is $nis_server_full_hostname\"\n\nexport nis_sudo_group_name=\"sudogroup\"\necho \"nis_sudo_group_name is $nis_sudo_group_name\"\n\n\nyum -y install ypbind-1.37.1-9.el7.x86_64 rpcbind-0.2.0-47.el7.x86_64\nypdomainname $nis_domain_name\necho \"NISDOMAIN=$nis_domain_name\" \u003e\u003e /etc/sysconfig/network\ncat /etc/sysconfig/network\nauthconfig --enablenis --nisdomain=$nis_domain_name --nisserver=$nis_server_full_hostname --enablemkhomedir --update\nsystemctl start rpcbind ypbind\necho '%${nis_sudo_group_name}      ALL=(ALL)       NOPASSWD: ALL' \u003e\u003e /etc/sudoers\ngetent passwd | grep nistest\ngetent group| grep nistest\ngetent group $nis_sudo_group_name\nid nistest\n",
                            "template": "#!/bin/bash\n#######################################################################################################################################################\n### This bootstrap script runs on glusterfs clients and does the following\n### 1- Install gluster packages on all nodes\n### 2- Mount client to the glusterFS server volume\n### 3- Check if mounted successfully by command \"df\"\n######################################################################################################################################################\n\nexec \u0026\u003e bootstrap-client-logfile.txt\nset -x\n\nexport server_host_name=\"${server_host_name}\"\necho \"server_host_name is $server_host_name\"\n\nexport nis_domain_name=\"${nis_domain_name}\"\necho \"nis_domain_name is $nis_domain_name\"\n\nexport server_domain_name=\"${server_domain_name}\"\necho \"server_domain_name is $server_domain_name\"\n\nexport nis_server_full_hostname=$server_host_name.$server_domain_name\necho \"nis_server_full_hostname is $nis_server_full_hostname\"\n\nexport nis_sudo_group_name=\"${nis_sudo_group_name}\"\necho \"nis_sudo_group_name is $nis_sudo_group_name\"\n\n\nyum -y install ypbind-1.37.1-9.el7.x86_64 rpcbind-0.2.0-47.el7.x86_64\nypdomainname $nis_domain_name\necho \"NISDOMAIN=$nis_domain_name\" \u003e\u003e /etc/sysconfig/network\ncat /etc/sysconfig/network\nauthconfig --enablenis --nisdomain=$nis_domain_name --nisserver=$nis_server_full_hostname --enablemkhomedir --update\nsystemctl start rpcbind ypbind\necho '%${nis_sudo_group_name}      ALL=(ALL)       NOPASSWD: ALL' \u003e\u003e /etc/sudoers\ngetent passwd | grep nistest\ngetent group| grep nistest\ngetent group $nis_sudo_group_name\nid nistest\n",
                            "vars.%": "4",
                            "vars.nis_domain_name": "nisser.nis.oraclevcn.com",
                            "vars.nis_sudo_group_name": "sudogroup",
                            "vars.server_domain_name": "nisser.nis.oraclevcn.com",
                            "vars.server_host_name": "nis-server"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.template"
                },
                "data.template_file.nis_server_script": {
                    "type": "template_file",
                    "depends_on": [],
                    "primary": {
                        "id": "7505ca23dfb871fd94b108b18cce2e13844bf29076abd338717375af2585dadf",
                        "attributes": {
                            "id": "7505ca23dfb871fd94b108b18cce2e13844bf29076abd338717375af2585dadf",
                            "rendered": "#!/bin/bash\n#######################################################################################################################################################\n### This bootstrap script runs on glusterfs servers and does the following\n### 1- install \u0026 start glusterfs server packages on all server nodes\n### 2- Prepare bricks for creating glusterfs volume\n### 3- Only open the needed ports in firewall\n### 4- Add each sever into glusterfs peers\n######################################################################################################################################################\n\nexec \u0026\u003e bootstrap-server-logfile.txt\nset -x\n\n\nexport nis_server_sercure_net_list=\"255.255.0.0 10.0.0.0\"\necho \"nis_server_sercure_net_list is $nis_server_sercure_net_list\"\nnis_server_sercure_net_array=($nis_server_sercure_net_list)\nnis_server_sercure_net_array_size=\"${#nis_server_sercure_net_array[@]}\"\necho \"nis_server_sercure_net_array_size is $nis_server_sercure_net_array_size\"\n\nexport nis_sudo_group_name=\"sudogroup\"\necho \"nis_sudo_group_name is $nis_sudo_group_name\"\n\nyum -y install ypserv-2.31-11.el7.x86_64 rpcbind-0.2.0-47.el7.x86_64 expect-5.45-14.el7_1.x86_64\nthis_hostname=`hostname -f`\necho $this_hostname\n#first_dot_index=`expr index $this_hostname '.'`\n#nis_domain_idex=$((first_dot_index + 1))\n#nis_domain_name=`expr substr $this_hostname $nis_domain_idex ${#this_hostname}`\n\nexport nis_domain_name=\"nisser.nis.oraclevcn.com\"\necho \"nis_domain_name is $nis_domain_name\"\necho $nis_domain_name\n\nypdomainname $nis_domain_name\necho \"NISDOMAIN=$nis_domain_name\" \u003e\u003e /etc/sysconfig/network\ncat /etc/sysconfig/network\ncat /etc/hosts\n\nif [ nis_server_sercure_net_array_size \u003e 0]; then\n    touch /var/yp/securenets\n    for ((i=0; i\u003c=nis_server_sercure_net_array_size-1; i++)); do\n       export tmp_sercure_net=${nis_server_sercure_net_array[i]}\n       echo $tmp_sercure_net \u003e\u003e/var/yp/securenets\n    done\nfi\n\ncat /var/yp/securenets\nsystemctl start rpcbind ypserv ypxfrd yppasswdd\nsystemctl enable rpcbind ypserv ypxfrd yppasswdd\n\n/usr/bin/expect \u003c\u003cEOD\nspawn /usr/lib64/yp/ypinit -m\nexpect \"next host to add:\"\nsend \"\\x04\"\nsend \"\\r\"\nsend \"\\r\"\nsend \"\\r\"\nexpect \"\\]\\s*\"\nsend \"y\\r\"\ninteract\nEOD\n\necho 'YPSERV_ARGS=\"-p 944\"' \u003e\u003e/etc/sysconfig/network\necho 'YPXFRD_ARGS=\"-p 945\"' \u003e\u003e/etc/sysconfig/network\ncat /etc/sysconfig/network\nsed -i 's/YPPASSWDD_ARGS=/YPPASSWDD_ARGS=\"--port 946\"/g' /etc/sysconfig/yppasswdd\ncat /etc/sysconfig/yppasswdd\nfirewall-cmd --add-service=rpc-bind --permanent\nfirewall-cmd --add-port=944/tcp --permanent\nfirewall-cmd --add-port=944/udp --permanent\nfirewall-cmd --add-port=945/tcp --permanent\nfirewall-cmd --add-port=945/udp --permanent\nfirewall-cmd --add-port=946/udp --permanent\nfirewall-cmd --reload\nsestatus\nsetenforce 0\nsestatus\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\ncat /etc/selinux/config\n\nsystemctl restart rpcbind ypserv ypxfrd yppasswdd\nuseradd nistest\n/usr/bin/expect \u003c\u003cEOD\nspawn passwd nistest\nexpect \"*New password:*\"\nsend \"DPdengjia8*\\r\"\nexpect \":\"\nsend \"DPdengjia8*\\r\"\nexpect \".\"\ninteract\nEOD\n\ngroupadd $nis_sudo_group_name\nusermod -a -G $nis_sudo_group_name nistest\nid nistest\necho '%${nis_sudo_group_name}      ALL=(ALL)       NOPASSWD: ALL' \u003e\u003e /etc/sudoers\n\ncd /var/yp\nls\nmake\nls\ngetent passwd|grep nistest\ngetent group $nis_sudo_group_name\n\n\n",
                            "template": "#!/bin/bash\n#######################################################################################################################################################\n### This bootstrap script runs on glusterfs servers and does the following\n### 1- install \u0026 start glusterfs server packages on all server nodes\n### 2- Prepare bricks for creating glusterfs volume\n### 3- Only open the needed ports in firewall\n### 4- Add each sever into glusterfs peers\n######################################################################################################################################################\n\nexec \u0026\u003e bootstrap-server-logfile.txt\nset -x\n\n\nexport nis_server_sercure_net_list=\"${nis_server_sercure_net_list}\"\necho \"nis_server_sercure_net_list is $nis_server_sercure_net_list\"\nnis_server_sercure_net_array=($nis_server_sercure_net_list)\nnis_server_sercure_net_array_size=\"$${#nis_server_sercure_net_array[@]}\"\necho \"nis_server_sercure_net_array_size is $nis_server_sercure_net_array_size\"\n\nexport nis_sudo_group_name=\"${nis_sudo_group_name}\"\necho \"nis_sudo_group_name is $nis_sudo_group_name\"\n\nyum -y install ypserv-2.31-11.el7.x86_64 rpcbind-0.2.0-47.el7.x86_64 expect-5.45-14.el7_1.x86_64\nthis_hostname=`hostname -f`\necho $this_hostname\n#first_dot_index=`expr index $this_hostname '.'`\n#nis_domain_idex=$((first_dot_index + 1))\n#nis_domain_name=`expr substr $this_hostname $nis_domain_idex $${#this_hostname}`\n\nexport nis_domain_name=\"${nis_domain_name}\"\necho \"nis_domain_name is $nis_domain_name\"\necho $nis_domain_name\n\nypdomainname $nis_domain_name\necho \"NISDOMAIN=$nis_domain_name\" \u003e\u003e /etc/sysconfig/network\ncat /etc/sysconfig/network\ncat /etc/hosts\n\nif [ nis_server_sercure_net_array_size \u003e 0]; then\n    touch /var/yp/securenets\n    for ((i=0; i\u003c=nis_server_sercure_net_array_size-1; i++)); do\n       export tmp_sercure_net=$${nis_server_sercure_net_array[i]}\n       echo $tmp_sercure_net \u003e\u003e/var/yp/securenets\n    done\nfi\n\ncat /var/yp/securenets\nsystemctl start rpcbind ypserv ypxfrd yppasswdd\nsystemctl enable rpcbind ypserv ypxfrd yppasswdd\n\n/usr/bin/expect \u003c\u003cEOD\nspawn /usr/lib64/yp/ypinit -m\nexpect \"next host to add:\"\nsend \"\\x04\"\nsend \"\\r\"\nsend \"\\r\"\nsend \"\\r\"\nexpect \"\\]\\s*\"\nsend \"y\\r\"\ninteract\nEOD\n\necho 'YPSERV_ARGS=\"-p 944\"' \u003e\u003e/etc/sysconfig/network\necho 'YPXFRD_ARGS=\"-p 945\"' \u003e\u003e/etc/sysconfig/network\ncat /etc/sysconfig/network\nsed -i 's/YPPASSWDD_ARGS=/YPPASSWDD_ARGS=\"--port 946\"/g' /etc/sysconfig/yppasswdd\ncat /etc/sysconfig/yppasswdd\nfirewall-cmd --add-service=rpc-bind --permanent\nfirewall-cmd --add-port=944/tcp --permanent\nfirewall-cmd --add-port=944/udp --permanent\nfirewall-cmd --add-port=945/tcp --permanent\nfirewall-cmd --add-port=945/udp --permanent\nfirewall-cmd --add-port=946/udp --permanent\nfirewall-cmd --reload\nsestatus\nsetenforce 0\nsestatus\nsed -i 's/SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config\ncat /etc/selinux/config\n\nsystemctl restart rpcbind ypserv ypxfrd yppasswdd\nuseradd nistest\n/usr/bin/expect \u003c\u003cEOD\nspawn passwd nistest\nexpect \"*New password:*\"\nsend \"DPdengjia8*\\r\"\nexpect \":\"\nsend \"DPdengjia8*\\r\"\nexpect \".\"\ninteract\nEOD\n\ngroupadd $nis_sudo_group_name\nusermod -a -G $nis_sudo_group_name nistest\nid nistest\necho '%${nis_sudo_group_name}      ALL=(ALL)       NOPASSWD: ALL' \u003e\u003e /etc/sudoers\n\ncd /var/yp\nls\nmake\nls\ngetent passwd|grep nistest\ngetent group $nis_sudo_group_name\n\n\n",
                            "vars.%": "3",
                            "vars.nis_domain_name": "nisser.nis.oraclevcn.com",
                            "vars.nis_server_sercure_net_list": "255.255.0.0 10.0.0.0",
                            "vars.nis_sudo_group_name": "sudogroup"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.template"
                },
                "null_resource.configure_nis_client.0": {
                    "type": "null_resource",
                    "depends_on": [
                        "data.template_file.nis_client_script",
                        "null_resource.configure_nis_server"
                    ],
                    "primary": {
                        "id": "5378506265362653676",
                        "attributes": {
                            "id": "5378506265362653676"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.null"
                },
                "null_resource.configure_nis_client.1": {
                    "type": "null_resource",
                    "depends_on": [
                        "data.template_file.nis_client_script",
                        "null_resource.configure_nis_server"
                    ],
                    "primary": {
                        "id": "9093720426484156338",
                        "attributes": {
                            "id": "9093720426484156338"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.null"
                },
                "null_resource.configure_nis_server": {
                    "type": "null_resource",
                    "depends_on": [
                        "data.template_file.nis_server_script"
                    ],
                    "primary": {
                        "id": "2422959146261082582",
                        "attributes": {
                            "id": "2422959146261082582"
                        },
                        "meta": {},
                        "tainted": false
                    },
                    "deposed": [],
                    "provider": "provider.null"
                }
            },
            "depends_on": []
        }
    ]
}
